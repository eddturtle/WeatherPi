<!doctype html>
<html>
	<head>
		<title>Weather</title>
		<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}" />
		<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
	</head>
	<body>

		<div class="container">

			<!-- Title -->
			<h1>WeatherPi</h1>

			<!-- Latest Data -->
			<div class="latest-data">
				Latest Recorded Temperature:
				<span class="temperature"></span>
				(<span class="date"></span>)
			</div>

			<!-- All Data -->
			<table class="table past-week"></table>
		</div>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
		<script>
			var pastWeek = [];

			$(document).ready( function() {
				var d = new Date().getTime();
				$.ajax({
					url: 'api/v1/0/0',
					type: 'GET',
					dataType: 'json',
					contentType: 'application/json',
					success: function(json) {
						var latest = json.instances[0];
						$('.latest-data .temperature').html( latest.temp_instance / 1000 );
						$('.latest-data .date').html( latest.temp_date );
						pastWeek = json.instances;
						fillTable(pastWeek, $('past-week'));
					}
				});
			});

			function fillTable(instances, table) {
				$.each(instances, function(i, val) {
					var html = '<tr>';
					html += '<td>' + val.temp_date + '</td>';
					html += '<td>' + (val.temp_instance/1000).toFixed(1) + '&deg;c</td>';
					html += '</tr>';
					table.append(html);
				});
			}
		</script>

	</body>
</html>